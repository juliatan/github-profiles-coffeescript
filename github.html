<html>
  <head>
    <title>Github profiles</title>
    <link href='github.css' rel='stylesheet'>
  </head>
  <body>
    <form id='add_profile'>
      <input id='username' placeholder='Enter a Github username'>
      <button type='submit' id="submit">Load profile</button>
    </form>
    
    <img class="spinner" src="spinner.gif" />

    <div class='profile-container'>
    </div>

    <template id='profile-template'>
      <div class="profile">
        <div class="left">
          <img src="{{ avatar_url }}">
        </div>

        <div class="right">
          <button class="delete">X</button>
          <h3>
            <a href="{{ html_url }}">
              {{ login }}
            </a>
          </h3>
          <h4>Repos: {{ public_repos }}</h4>
          <h4>Followers: {{ followers }}</h4>
        </div>
        <br clear="all">
      </div>
    </template>

    <script src='https://code.jquery.com/jquery-2.0.3.min.js'></script>
    <script src='mustache.js'></script>
    <script>

      // setup a new function that gets profile from Github
      function getProfile(username) {
        $('.spinner').show();
        // GET api (in JSON form) for the searched user
        $.get('https://api.github.com/users/'+ username, function(user){
          // render the javascript within the template #profile-template tag
          var newProfile = Mustache.render($('#profile-template').html(), user);
          // display these profiles within the profile-container class
          $('.profile-container').prepend(newProfile);
        }).error(function(){
          // if there is an error, alert us
          alert("There is no user called " + username);
        }).always(function(){
          // remove search bar placeholder
          $('#username').val('');
          // once profile is found, hide spinner
          $('.spinner').hide();
        })
      };

      $(document).ready(function(){
        // sub in these array of names into the getProfile method and bring up profiles
        ['alexmakers', 'juliatan'].forEach(function(username){
          getProfile(username);
        });
        // when clicking the submit button..
        $('#add_profile').on('submit', function(juliarr) {
          // stop the clicking even from refreshing the page (default action)
          juliarr.preventDefault();
          // and get the profile for the username placed in the search bar
          getProfile($('#username').val())
        });
        // cannot directly remove the #delete element because it will not take
        // into account new items dynamically placed on the page
        // therefore find the parent element, that on click, searches for the
        // delete class element
        // that then removes the closest .profile element (instead of all the
        // .profile elements on the page
        $('.profile-container').on('click', '.delete', function() {
          // console.log("hello");
          // $('#delete').css('display', 'none');
          $(this).closest('.profile').remove();
        });
      });
    </script>
  </body>
</html>